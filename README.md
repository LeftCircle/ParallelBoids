# Godot Boids Simulation with C++ GDExtension and CUDA

## Description

This project implements a boids flocking simulation within the Godot Engine (v4.x). The core simulation logic is written in C++ using GDExtension, offering both CPU-based and CUDA-accelerated implementations for performance comparison.

## Features

*   **Boids Simulation:** Simulates the classic flocking behavior (separation, alignment, cohesion).
*   **Godot Integration:** Visualizes the boids simulation in a 3D Godot scene.
*   **C++ GDExtension:** Core logic implemented in C++ for performance.
*   **CPU Implementation:** A standard CPU-based boid calculation (`BoidSystem::update_boids_cpu`).
*   **CUDA Acceleration:** A highly parallelized CUDA implementation for significantly faster simulation of large numbers of boids (`BoidSystem::update_boids_cuda` calling CUDA kernels in `boid_cuda.cu`).
*   **Performance Profiling:** Built-in tools (`demo/scenes/world.gd`, `demo/resources/profile_timer.gd`) to measure and compare the performance of CPU vs. CUDA implementations across varying numbers of boids.
*   **Result Visualization:** A Python script (`graph.py`) using `matplotlib` to generate bar graphs comparing CPU and CUDA performance based on generated results files (`results.txt`, `results_usec_cuda.txt`).

## Prerequisites

*   **Godot Engine:** Version 4.x (tested with v4.4.1).
*   **C++ Compiler:** A compiler compatible with Godot GDExtension (e.g., MSVC on Windows, GCC/Clang on Linux/macOS).
*   **SCons:** Build system used for compiling the GDExtension.
*   **CUDA Toolkit:** Required for building and running the CUDA-accelerated version. Ensure your GPU is CUDA-compatible.
*   **Python 3:** Required for running the graphing script.

## Building the GDExtension

1.  Ensure all prerequisites (Compiler, SCons, CUDA Toolkit) are installed and configured in your system's PATH.
2.  Open a terminal or command prompt in the project's root directory (`c:\Godot\Godot4Projects\boids`).
3.  Run the SCons build command. The exact command might depend on your setup (debug/release, platform), but it will typically be similar to:
    ```bash
    scons platform=windows # Or linux, macos
    ```
    *(Refer to the `SConstruct` file and Godot GDExtension documentation for specific build options.)*
4.  Successful compilation will place the necessary library files (e.g., `libgdexample.windows.template_debug.x86_64.dll`) inside the `demo/bin` directory.

## Running the Demo

1.  Build the GDExtension as described above.
2.  Open the Godot Engine.
3.  Import the project by selecting the `demo/project.godot` file.
5.  Run the project. By default, it should run the CUDA simulation if available.

## Profiling

1.  Open the `demo/scenes/World.tscn` scene in the Godot editor.
2.  Select the `World` node in the Scene tree.
3.  In the Inspector panel:
    *   Set `To Profile` to `true`.
    *   Set `Prof Cpu` to `true` if you want to include CPU timings (can be very slow for many boids). Otherwise, only CUDA will be profiled.
    *   Adjust `Boid Range` (min/max number of boids), `Boids To Increase By`, and `Steps Per Sim` as needed.
4.  Run the scene (F5).
5.  The simulation will run through the specified range of boid counts, performing calculations for the set number of steps for each count.
6.  Timings will be printed to the Godot output console and saved to `results.txt` (CPU and CUDA in msec) and `results_usec_cuda.txt` (CUDA only in usec).
7.  Once finished, "FINISHED" will be printed.

## Project Structure

*   `demo/`: Contains the Godot project files, scenes, scripts, and compiled GDExtension binaries.
*   `godot-cpp/`: Submodule containing the Godot C++ bindings.
*   `src/`: Contains the C++ source code for the GDExtension (CPU logic, CUDA kernels, bindings).
*   `graph.py`: Python script for plotting results.
*   `results*.txt`: Text files containing raw performance data from profiling runs.
*   `results*.png`: Output graphs generated by `graph.py`.
*   `SConstruct`: SCons build script for the GDExtension.
*   `README.md`: This file.
